<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8">
  <title>Transacciones</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 24px; }
    h1 { margin-bottom: 8px; }
    form, table { width: 100%; max-width: 1100px; }
    .row { display: grid; grid-template-columns: repeat(6, 1fr); gap: 12px; }
    .row > div { display: flex; flex-direction: column; }
    input, select { padding: 8px; border: 1px solid #ccc; border-radius: 8px; }
    button { padding: 10px 14px; border: 0; border-radius: 10px; cursor: pointer; }
    .primary { background: #2563eb; color: white; }
    .danger { background: #dc2626; color: white; }
    table { border-collapse: collapse; margin-top: 24px; }
    th, td { padding: 8px 10px; border-bottom: 1px solid #eee; text-align: left; }
    .bar { display:flex; align-items:center; justify-content:space-between; gap:16px; margin: 12px 0 20px;}
    .msg { color:#dc2626; margin:8px 0; }
  </style>
</head>
<body>
  <h1>Transacciones</h1>

  <div class="msg" th:if="${error}" th:text="${error}"></div>

  <form th:action="@{/transacciones}" method="post" th:object="${form}">
    <div class="row">
      <div>
        <label>Fecha</label>
        <input type="date" th:field="*{fecha}" required>
      </div>
      <div>
        <label>Portafolio</label>
        <select th:field="*{portafolioId}" required>
          <option value="" disabled selected>Selecciona…</option>
          <option th:each="p : ${portafolios}" th:value="${p.id}" th:text="${p.nombre}"></option>
        </select>
      </div>
      <div>
        <label>Activo</label>
        <select th:field="*{activoId}" required>
          <option value="" disabled selected>Selecciona…</option>
          <option th:each="a : ${activos}" th:value="${a.id}" th:text="${a.nombre}"></option>
        </select>
      </div>
      <div>
        <label>Tipo</label>
        <select th:field="*{tipo}" required>
          <option value="BUY">BUY</option>
          <option value="SELL">SELL</option>
        </select>
      </div>
      <div>
        <label>Monto </label>
        <input type="number" step="0.01" min="0.01" th:field="*{montoUsd}" placeholder="Ej: 200000000" required>
      </div>
    </div>
    <div class="bar">
      <div></div>
      <button class="primary" type="submit">Agregar transacción</button>
    </div>
  </form>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Fecha</th>
        <th>Portafolio</th>
        <th>Activo</th>
        <th>Tipo</th>
        <th>Monto </th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr th:each="t : ${txs}">
        <td th:text="${t.id}">1</td>
        <td th:text="${t.fecha}">2022-05-15</td>
        <td th:text="${t.portafolio.nombre}">Portafolio 1</td>
        <td th:text="${t.activo.nombre}">EEUU</td>
        <td th:text="${t.tipo}">SELL</td>
        <td th:text="${#numbers.formatDecimal(t.montoUsd, 0, 'COMMA', 2, 'POINT')}">200000000.00</td>
        <td th:text="${t.precioUsado}">—</td>
        <td>
          <form th:action="@{|/transacciones/${t.id}/eliminar|}" method="post" style="display:inline">
            <button class="danger" type="submit">Eliminar</button>
          </form>
        </td>
      </tr>
    </tbody>
  </table>
</body>
</html>
